{% extends "base.html" %}

{% block title %}Flower Academy | {{ technique_title }} - Lesson {{ lesson_num }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 col-md-8 mx-auto">
        <!-- Progress bar -->
        <div class="progress mb-4" style="height: 30px;">
            <div class="progress-bar bg-success" role="progressbar" 
                style="width: {{ (lesson_num / total_lessons) * 100 }}%;" 
                aria-valuenow="{{ lesson_num }}" aria-valuemin="0" aria-valuemax="{{ total_lessons }}">
                {{ lesson_num }} / {{ total_lessons }}
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">{{ technique_title }}</h2>
            </div>
            <div class="card-body">
                {% if introduction %}
                <!-- Introduction content (displayed only on first lesson) -->
                <div class="introduction-panel mb-4">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <span class="intro-emoji display-1">{{ introduction.emoji }}</span>
                        </div>
                        <div class="col-md-9">
                            <h3>{{ introduction.title }}</h3>
                            <p>{{ introduction.description }}</p>
                            
                            <h5 class="mt-4">Key Points:</h5>
                            <ul class="key-points">
                                {% for point in introduction.keyPoints %}
                                <li>{{ point }}</li>
                                {% endfor %}
                            </ul>
                            
                            <div class="history-section mt-4">
                                <h5>Historical Context:</h5>
                                <p>{{ introduction.history }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Lesson content -->
                <div class="lesson-content p-4">
                    {% if lesson.type == 'lesson' %}
                    <div class="teacher-bubble">
                        <div class="teacher-icon mb-3">
                            <span class="emoji-icon display-3">{{ lesson.emoji }}</span>
                        </div>
                        <div class="lesson-text p-4 bg-light rounded">
                            <p class="lead">{{ lesson.content }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between">
                {% if lesson_num > 1 %}
                <a href="{{ url_for('learn', lesson_num=lesson_num-1) }}" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-left"></i> Previous
                </a>
                {% else %}
                <div></div>
                {% endif %}
                
                {% if lesson_num < total_lessons %}
                <a href="{{ url_for('learn', lesson_num=lesson_num+1) }}" class="btn btn-primary" id="next-button">
                    Next <i class="bi bi-arrow-right"></i>
                </a>
                {% else %}
                <a href="{{ url_for('quiz', question_num=1) }}" class="btn btn-success" id="start-quiz-button">
                    Start Quiz <i class="bi bi-check-circle"></i>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        // Log when page is viewed
        const lessonData = {
            technique: "{{ technique }}",
            lesson_num: {{ lesson_num }},
            timestamp: new Date().toISOString()
        };
        
        // Next button tracking
        $('#next-button, #start-quiz-button').on('click', function() {
            $.post('/log', {
                action: 'lesson_completed',
                data: JSON.stringify({
                    technique: "{{ technique }}",
                    lesson_num: {{ lesson_num }}
                })
            });
        });
    });
</script>
{% endblock %} 